"use strict";var lastBuble,inputText=searchElement(".chat-window__text-buble-input"),inputForm=searchElement(".chat-window__text-buble"),submitBtn=searchElement(".chat-window__text-buble-button"),chatWindow=searchElement(".chat-window"),chatHistory=searchElement(".chat-window__history"),dots='<span class="dotted-anim">.</span><span class="dotted-anim">.</span><span class="dotted-anim">.</span><span class="dotted-anim">.</span>',isValid=function(e){return 0<e.length};function scrollToBottom(e){var t=e.scrollHeight;e.scrollTop=t}function searchElement(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)}function searchLastElement(e){e=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelectorAll(e);return e[e.length-1]}function searchElements(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelectorAll(e)}var newMessage=function(e,t,s){e=0<arguments.length&&void 0!==e?e:dots,s=2<arguments.length&&void 0!==s?s:"user";return"\n\t\t<div class='message' data-build='".concat(!(1<arguments.length&&void 0!==t)||t,"'>\n\t\t\t<div class='message__avatar message__avatar_").concat(s,"'></div>\n\t\t\t<div class='message__buble message__buble_").concat(s,"'>").concat(e,"</div>\n\t\t</div>\n\t")};function addMessage(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";(1<arguments.length?arguments[1]:void 0).insertAdjacentHTML("beforeend",e),scrollToBottom(chatHistory)}function submitMessage(){searchLastElement(".message__buble");var e=searchLastElement(".message");e.parentNode.removeChild(e),addMessage(newMessage(inputText.value,!1),chatHistory),sendMessage(inputText.value),inputForm.reset(),submitBtn.disabled=!isValid(inputText.value)}function sendMessage(e){fetch("localhost"===location.hostname?"".concat(location.protocol,"//").concat(location.hostname,":3000/request-to-bot"):"".concat(location.href,"request-to-bot"),{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({request:e})}).then(function(e){return e.json()}).then(function(e){return addMessage(newMessage(e.answer,!1,"bot"),chatHistory)})}inputText.addEventListener("focus",function(){var e=searchLastElement(".message");lastBuble&&"true"===e.dataset.build?searchLastElement(".message__buble_user").classList.add("message__buble_user_has-tail"):e&&"false"!==e.dataset.build||new Promise(function(e){addMessage(newMessage(),chatHistory),e(searchLastElement(".message__buble_user"))}).then(function(e){return e.classList.add("message__buble_user_has-tail"),e}).then(function(t){lastBuble=new Promise(function(e){e(t)})})}),inputText.addEventListener("blur",function(){lastBuble&&searchLastElement(".message__buble_user").classList.remove("message__buble_user_has-tail")});var dottedAnimate=function(){var t=0,s=700;return function(){var e=searchElements("span");return e[t].style.fontWeight=s,t>=e.length-1&&(t-=e.length,s=700===s?400:700),t++}},typping=dottedAnimate();inputText.addEventListener("input",function(){var e=searchLastElement(".message");submitBtn.disabled=!isValid(inputText.value),"true"===e.dataset.build?typping():(addMessage(newMessage(),chatHistory),searchLastElement(".message__buble").classList.add("message__buble_user_has-tail"))}),inputText.addEventListener("keydown",function(e){"Enter"!==e.code&&"NumpadEnter"!==e.code||(e.preventDefault(),isValid(inputText.value)&&submitMessage())}),submitBtn.addEventListener("click",function(){submitMessage()});